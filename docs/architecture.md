# 系统架构设计

## 整体架构

采用前后端分离的微服务架构：

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│     前端层       │    │     后端层       │    │     数据层       │
│                 │    │                 │    │                 │
│ Vue 3 + Element │◄──►│ Node.js +       │◄──►│ Supabase        │
│ Plus + Vite     │    │ Express/NestJS  │    │ (PostgreSQL +   │
│                 │    │                 │    │ Auth + Storage) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        │                        │                        │
        │                        │                        │
        ▼                        ▼                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI服务集成     │    │  第三方服务集成   │    │  文件存储服务    │
│                 │    │                 │    │                 │
│ NLP模型 + OCR   │    │ 电子签名 + 通知  │    │ 本地/云存储     │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 技术选型依据

### 前端选型
- **Vue 3**: 组合式API更符合现代开发习惯，性能优化更好
- **Element Plus**: 企业级UI组件库，功能完善，设计规范
- **Vite**: 快速构建工具，开发体验优秀
- **Pinia**: Vue 3推荐的状态管理库，轻量且类型安全

### 后端选型
- **Node.js**: JavaScript全栈开发，前后端语言统一
- **Express/NestJS**: Express轻量灵活，NestJS企业级框架
- **JWT**: 无状态认证，适合分布式系统

### 数据层选型
- **Supabase**: 开源Firebase替代，提供完整的后端服务
- **PostgreSQL**: 企业级关系型数据库，JSON支持良好
- **Row Level Security**: 行级安全，权限控制更精细

## 模块划分

### 前端模块
```
frontend/
├── src/
│   ├── components/     # 通用组件
│   ├── views/         # 页面组件
│   ├── stores/        # 状态管理
│   ├── router/        # 路由配置
│   ├── api/          # API接口
│   ├── utils/        # 工具函数
│   └── types/        # TypeScript类型定义
```

### 后端模块
```
backend/
├── src/
│   ├── controllers/   # 控制器层
│   ├── services/      # 业务逻辑层
│   ├── models/       # 数据模型层
│   ├── middleware/   # 中间件
│   ├── routes/       # 路由定义
│   ├── config/       # 配置文件
│   └── utils/        # 工具函数
```

## 数据流设计

### 合同上传流程
```
用户上传文件 → 前端校验 → Supabase Storage存储 → 后端调用OCR解析 → 
AI信息提取 → 结构化数据存入PostgreSQL → 返回解析结果
```

### 审批流程
```
发起审批 → 流程引擎生成节点 → 更新流程状态 → 推送通知 → 
处理人操作 → 更新流程状态 → 完成审批
```

## 安全设计

### 认证授权
- JWT Token认证
- RBAC角色权限控制
- 字段级权限控制

### 数据安全
- HTTPS传输加密
- 数据库字段加密
- 文件存储加密
- 操作日志审计

### 接口安全
- API签名验证
- 防SQL注入
- 防XSS攻击
- 限流保护

## 性能优化

### 前端优化
- 组件懒加载
- 图片压缩
- 代码分割
- 缓存策略

### 后端优化
- 数据库索引优化
- 查询优化
- 缓存机制
- 异步处理

### AI服务优化
- 模型缓存
- 批量处理
- 异步调用
- 结果缓存
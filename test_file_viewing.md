# 文件查看功能测试计划

## 修改总结

### 已完成的修改：

1. **合同列表页面** (`frontend/src/views/contracts/index.vue`)
   - ✅ 删除了"查看文件"按钮，改为"查看详情"按钮
   - ✅ 修改了按钮宽度从250px到200px
   - ✅ 增强了`viewContractFile`函数，统一使用智能文本提取功能
   - ✅ 支持.pdf、.doc、.docx、.txt、.md格式

2. **合同详情页面** (`frontend/src/views/contracts/Detail.vue`)
   - ✅ 删除了"PDF预览"按钮
   - ✅ 删除了View图标的导入
   - ✅ 删除了`viewContract`函数和相关的PDF预览逻辑
   - ✅ 修改了"查看文件"按钮为"查看详情"按钮
   - ✅ 增强了`viewFile`函数，统一使用文本提取页面

3. **文本提取页面** (`frontend/src/views/contracts/TextExtract.vue`)
   - ✅ 增强了PDF文本提取功能，改进了错误处理
   - ✅ 添加了mammoth.js支持，用于.docx文件解析
   - ✅ 改进了Word文档的二进制提取逻辑
   - ✅ 增加了GBK编码支持，更好地处理中文Word文档
   - ✅ 完善了错误提示和用户指导信息

## 功能说明

### 新的文件查看流程：

1. **合同列表页** → 点击"查看详情"按钮 → **合同详情页**
2. **合同详情页** → 点击"查看详情"按钮 → **智能文本提取页**

### 支持的文件格式：
- ✅ **PDF文档** (.pdf) - 智能文本提取，支持多种解析方法
- ✅ **Word文档** (.doc, .docx) - mammoth.js + 二进制提取
- ✅ **文本文件** (.txt, .md) - 直接文本读取

### 智能提取特性：
- 多级备用提取方法
- 支持中文内容识别
- PDF.js专业PDF解析
- Word文档智能解析
- 错误处理和用户友好提示
- 内容质量检查

## 测试用例

### 测试用例1：PDF文件提取
**操作步骤：**
1. 在合同列表页选择一个PDF文件合同
2. 点击"查看详情"进入合同详情页
3. 点击"查看详情"按钮
4. 验证是否正确跳转到文本提取页
5. 验证是否成功提取PDF文本内容

**预期结果：**
- ✅ 正确提取PDF文本内容
- ✅ 显示提取状态为"已提取"
- ✅ 支持文本搜索和复制功能

### 测试用例2：Word文档提取
**操作步骤：**
1. 在合同列表页选择一个Word文档合同(.doc或.docx)
2. 点击"查看详情"进入合同详情页
3. 点击"查看详情"按钮
4. 验证是否正确跳转到文本提取页
5. 验证是否成功提取Word文档内容

**预期结果：**
- ✅ 对于.docx文件，使用mammoth.js成功提取文本
- ✅ 对于.doc文件，使用二进制方法提取文本
- ✅ 显示提取的文档内容

### 测试用例3：文本文件提取
**操作步骤：**
1. 在合同列表页选择一个文本文件合同(.txt或.md)
2. 点击"查看详情"进入合同详情页
3. 点击"查看详情"按钮
4. 验证是否直接显示文本内容

**预期结果：**
- ✅ 直接读取并显示文本内容
- ✅ 完整保留原始格式

### 测试用例4：不支持的格式处理
**操作步骤：**
1. 在合同列表页选择一个不支持的格式合同
2. 点击"查看详情"按钮

**预期结果：**
- ✅ 显示友好的错误提示
- ✅ 列出支持的文件格式

### 测试用例5：错误处理
**操作步骤：**
1. 选择一个损坏的文件
2. 尝试提取文本内容

**预期结果：**
- ✅ 显示适当的错误信息
- ✅ 提供重试选项
- ✅ 显示查看原文件的备选方案

## 验证清单

- [ ] 合同列表页按钮文字从"查看文件"改为"查看详情"
- [ ] 合同详情页删除PDF预览按钮
- [ ] 合同详情页按钮文字从"查看文件"改为"查看详情"
- [ ] PDF文件能够成功提取文本内容
- [ ] Word文档(.docx)能够成功提取文本内容
- [ ] Word文档(.doc)能够尝试提取文本内容
- [ ] 文本文件能够直接显示内容
- [ ] 不支持的格式显示友好错误提示
- [ ] 提取失败时提供重试选项
- [ ] 提取成功时显示内容统计信息
- [ ] 支持文本搜索和高亮功能
- [ ] 支持文本复制和下载功能

## 技术改进

1. **统一入口：** 所有文件查看操作统一通过文本提取页面处理
2. **智能识别：** 自动识别文件格式并选择合适的提取方法
3. **多级备用：** 每种文件格式都有多种备用提取方法
4. **错误恢复：** 完善的错误处理和用户指导
5. **编码支持：** 支持UTF-8和GBK等多种编码格式
6. **质量控制：** 文本质量检查，确保提取内容可用性

## 用户体验优化

1. **简化流程：** 减少用户选择，系统自动判断最佳查看方式
2. **统一体验：** 所有文件类型使用相同的查看界面
3. **智能提示：** 根据文件类型显示相应的提示信息
4. **快速反馈：** 实时显示提取进度和状态
5. **友好错误：** 详细的错误说明和解决方案建议